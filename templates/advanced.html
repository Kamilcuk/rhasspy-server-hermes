{% extends "layout.html" %}
{% block body %}
<div class="container">
    <div class="text-muted pl-1">
        <p>
            You can edit <a href="https://rhasspy.readthedocs.io/en/latest/profiles/">your Rhasspy profile</a> directly here as JSON.
            Only settings that <strong>differ from the defaults</strong> are shown.
        </p>
    </div>
    <form class="form" method="post" onsubmit="beforeSubmit()">
        <div class="form-group">
            <div class="form-row">
                <button type="submit" class="btn btn-primary profile-json-button">Save Profile</button>
            </div>
        </div>

        <div class="form-group">
            <div class="form-row">
                <textarea id="profileJson" name="profileJson" class="form-control" style="border-width: 3px" type="text" rows="15" oninput="setDirty()">{{ profile_json | safe }}</textarea>
            </div>
        </div>

        <div class="form-group">
            <div class="form-row">
                <button type="submit" class="btn btn-primary profile-json-button">Save Profile</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
 var isDirty = false;

 function setDirty() {
     isDirty = true;
     $('#profile-settings').css('border-color', 'red');
     $('.profile-json-button').addClass('btn-danger');
 }

 function beforeSubmit() {
     isDirty = false;
     rhasspy.showBusy('Saving profile');
 }

 window.onbeforeunload = function() {
     if (isDirty) {
         return 'Profile was not saved. Are you sure?"'
     }
 }
</script>
{% endblock %}
